<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>فاتورة ضريبية مبسطة</title>
    <style>
        /* Your CSS styles here - same as original */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', 'Segoe UI', Tahoma, sans-serif; background-color: #f5f5f5; padding: 20px; }
        .invoice-container { max-width: 210mm; margin: 0 auto; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; align-items: flex-start; padding: 20px; border-bottom: 1px solid gray; }
        .logo-section { width: 100px; }
        .logo { width: 80px; height: 80px; object-fit: contain; }
        .qr-section { width: 30px; text-align: center; }
        .qr-code { width: 80px; height: 80px; object-fit: contain; }
        .company-info { text-align: right; flex: 1; padding: 0 20px; }
        .company-name { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .company-subtitle { font-size: 12px; margin-bottom: 10px; }
        .company-details { font-size: 11px; line-height: 1.6; }
        .invoice-info { display: flex; justify-content: space-between; padding: 15px 20px; background: #ffff; border-bottom: 1px solid #ddd; }
        .invoice-left { display: flex; gap: 40px; }
        .invoice-field { font-size: 11px; }
        .invoice-label { color: #666; margin-bottom: 3px; }
        .invoice-value { color: #d32f2f; font-weight: bold; }
        .invoice-type { text-align: center; }
        .invoice-type-label { font-size: 10px; color: #666; margin-bottom: 3px; }
        .invoice-type-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; }
        .payment-method { font-size: 12px; color: #d32f2f; font-weight: bold; }
        .invoice-number-box { border: 1px solid gray; padding: 5px 15px; }
        .invoice-number { font-size: 16px; font-weight: bold; text-align: center; }
        .vehicle-info { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; }
        .vehicle-brand { display: flex; align-items: center; gap: 15px; }
        .vehicle-model, .vehicle-year { font-size: 20px; font-weight: bold; }
        .tax-info, .customer-label { font-size: 11px; color: #666; }
        .mobile-number { font-size: 13px; direction: ltr; }
        .stamps-box { border: 2px solid #000; padding: 8px 12px; }
        .stamp-row { display: flex; justify-content: space-between; align-items: center; gap: 20px; margin-bottom: 3px; font-size: 11px; }
        .stamp-label { font-weight: bold; }
        .stamp-value { direction: ltr; font-weight: bold; }
        .table-header, .spare-parts-header {
            background: #1976d2; color: white; display: grid; 
            grid-template-columns: 40px 100px 1fr 60px 100px 100px;
            font-weight: bold; font-size: 12px; text-align: center;
        }
        .table-header div, .spare-parts-header div { padding: 12px 5px; border-left: 1px solid #fff; }
        .table-header div:first-child, .spare-parts-header div:first-child { border-left: none; }
        .table-body, .spare-parts-body { min-height: 150px; background: #f5f5f5; }
        .table-row, .spare-row {
            display: grid; grid-template-columns: 40px 100px 1fr 60px 100px 100px;
            border-bottom: 1px solid #ddd; text-align: center; font-size: 11px;
        }
        .table-row div, .spare-row div { padding: 10px 5px; border-left: 1px solid #ddd; display: flex; align-items: center; justify-content: center; }
        .table-row div:first-child, .spare-row div:first-child { border-left: none; }
        .bottom-section { display: grid; grid-template-columns: 1fr 1fr; border-top: 2px solid rgb(233, 233, 233); }
        .terms-section { padding: 20px; border-left: 1px solid #ddd; background: #fff; }
        .terms-title { font-weight: bold; margin-bottom: 12px; font-size: 13px; text-align: center; }
        .terms-content { text-align: justify; font-size: 13px; line-height: 1.8; color: #000; }
        .manager-section { display: flex; justify-content: center; gap: 4px; margin-top: 20px; text-align: center; font-weight: bold; font-size: 12px; padding-top: 15px; border-top: 1px solid #ddd; }
        .summary-section { display: flex; flex-direction: column; }
        .summary-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid #ddd; font-size: 13px; background: #f9f9f9; }
        .summary-row.red { background: #c93434; color: white; }
        .summary-row.gray { background: #e8e8e8; }
        .summary-row.blue { background: #1976d2; color: white; font-weight: bold; font-size: 14px; border-bottom: none; }
        .summary-label { display: flex; align-items: center; gap: 10px; }
        .summary-icon { display: block; align-items: center; font-size: 24px; font-weight: bold; }
        .summary-content { display: flex; justify-content: space-between; padding: 10px; width: 310px; }
        
        @media print {
            body { background: white; padding: 0; }
            .invoice-container { box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <!-- Header -->
        <div class="header">
            <div class="logo-section">
                <img src="<%= providerWorkShopImage %>" class="logo" alt="Workshop Logo">
            </div>
            <div class="qr-section">
                <img src="<%= invoiceQrLink %>" class="qr-code" alt="QR Code">
            </div>
            <div class="company-info">
                <div class="company-name"><%= data.providerWorkShopId.workshopNameArabic %></div>
                <div class="company-subtitle"><%= data.providerWorkShopId.workshopNameEnglish %></div>
                <div class="company-details">
                    <div>الرقم الضريبي: CR No. : <%= data.providerWorkShopId.crn %></div>
                    <div>الرقم الضريبي: VAT No. : <%= data.providerWorkShopId.taxVatNumber %></div>
                    <div>الحساب البنكي: IBan No. : <%= data.providerWorkShopId.bankAccountNumber %></div>
                </div>
            </div>
        </div>

        <!-- Invoice Info -->
        <div class="invoice-info">
            <div class="invoice-left">
                <div class="invoice-field">
                    <div class="invoice-label">invoice no. <b>رقم الفاتورة</b></div>
                    <div class="invoice-value"><%= data._id %></div>
                </div>
                <div class="invoice-field">
                    <div class="invoice-label">invoice date <b>تاريخ الفاتورة</b></div>
                    <div class="invoice-value"><%= invoiceCreatedAtt %></div>
                </div>
            </div>
            <div class="invoice-type">
                <div class="invoice-type-label">(Simplified tax invoice)</div>
                <div class="invoice-type-title">فاتورة ضريبية مبسطة</div>
                <div class="payment-method"><%= data.paymentMethod %></div>
            </div>
            <%= interNationalCarNumberComponent %>
        </div>

        <!-- Vehicle Info -->
        <div class="vehicle-info">
            <div class="vehicle-brand">
                <div class="logo-section">
                    <img src="<%= carBrandImage %>" class="logo" alt="Car Brand Logo">
                </div>
                <div class="vehicle-model"><%= data.car.brand.title %></div>
            </div>
            <div class="vehicle-model"><%= data.car.model.title %></div>
            <div class="vehicle-year"><%= data.car.year %></div>
            <div style="text-align: center;">
                <div class="tax-info">الرقم الضريبي: VAT -<%= data.providerWorkShopId.taxVatNumber %></div>
                <div class="mobile-number">الجوال: <%= data.providerWorkShopId.contact %></div>
                <div class="customer-label">العميل: <%= data.client.clientId.name %></div>
            </div>
            <%= saudiCarPlateComponent %>
        </div>

        <!-- Works Table -->
        <div class="table-header">
            <div>N</div>
            <div>الرمز<br />Code</div>
            <div>الأعمــــال Works</div>
            <div>عدد<br />Qt.</div>
            <div>السعر<br />Price</div>
            <div>الإجمالي<br />Total</div>
        </div>
        <div class="table-body">
            <% if (data.worksList.length > 0) { %>
                <% data.worksList.forEach((item, index) => { %>
                    <div class="table-row">
                        <div><%= index + 1 %></div>
                        <div><%= item.work.code %></div>
                        <div><%= item.work.title[lang] %></div>
                        <div><%= item.quantity %></div>
                        <div><%= item.cost %></div>
                        <div><%= item.finalCost %></div>
                    </div>
                <% }); %>
            <% } else { %>
                <div class="table-row">
                    <div>1</div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            <% } %>
        </div>

        <!-- Spare Parts Table -->
        <div class="spare-parts-header">
            <div>N</div>
            <div>الرمز<br />Code</div>
            <div>قطع غيار Spare Parts</div>
            <div>عدد<br />Qt.</div>
            <div>السعر<br />Price</div>
            <div>الإجمالي<br />Total</div>
        </div>
        <div class="spare-parts-body">
            <% if (data.sparePartsList.length > 0) { %>
                <% data.sparePartsList.forEach((item, index) => { %>
                    <div class="spare-row">
                        <div><%= index + 1 %></div>
                        <div><%= item.code %></div>
                        <div><%= item.itemName %></div>
                        <div><%= item.quantity %></div>
                        <div><%= item.cost %></div>
                        <div><%= item.finalCost %></div>
                    </div>
                <% }); %>
            <% } else { %>
                <div class="spare-row">
                    <div>1</div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            <% } %>
        </div>

        <!-- Bottom: Terms & Summary -->
        <div class="bottom-section">
            <div class="terms-section">
                <div class="terms-title">(Warranty and maintenance terms)<br />شروط الضمان والصيانة</div>
                <div class="terms-content">
                    المركز يضمن أعمال شغل اليد فقط إذا كانت القطع المستبدلة أصلية ومدة الضمان لا تتجاوز شهر من تاريخ الفاتورة<br />
                    المركز غير مسئول عن قطع الغيار القديمة بعد استبدالها وعدم قيام العميل بطلبها وأخذها بعد الصيانة مباشرة ويعد تصريح مباشر بالاستغناء عنها ولا يسأل عنها الورشة مطلقا<br />
                    المركز غير مسئول عن تركيب قطع الغيار المستعملة وفي حالة وجود خلل بها يتطلب الفك والتركيب أكثر من مرة يتحمل العميل قيمة شغل اليد عن الفك والتركيب في كل مرة<br />
                    المركز غير مسئول عن رسوب السيارة بالفحص الدوري
                </div>
                <div class="manager-section">
                    (Workshop Manager)
                    <div class="manager-name">اسامة الطاهر</div>
                </div>
            </div>
            <div class="summary-section">
                <div class="summary-row red">
                    <div class="summary-label">
                        <span class="summary-icon"><%= data.totalCostOfSparePartsExcludingTax %>﷼ </span>
                        <div class="summary-content">
                            <span>إجمالي مبلغ قطع الغيار (Total of spare parts)</span>
                        </div>
                    </div>
                </div>
                <div class="summary-row gray">
                    <div class="summary-label">
                        <span class="summary-icon"><%= data.totalCostExcludingTax %>﷼ </span>
                        <div class="summary-content">
                            <span> (Taxable amount)</span><span>المبلغ الخاضع للضريبة</span>
                        </div>
                    </div>
                </div>
                <div class="summary-row gray">
                    <div class="summary-label">
                        <span class="summary-icon"><%= data.finalDiscountInFlatAmount || 0 %>﷼ </span>
                        <div class="summary-content">
                            <span>(Discount)</span><span>الخصم قبل الضريبة</span>
                        </div>
                    </div>
                </div>
                <div class="summary-row gray">
                    <div class="summary-label">
                        <span class="summary-icon"><%= data.taxAmount || 0 %>﷼ </span>
                        <div class="summary-content">
                            <span> (VAT amount)</span> <span>(VAT 15%)الضريبة</span>
                        </div>
                    </div>
                </div>
                <div class="summary-row blue">
                    <div class="summary-label">
                        <span class="summary-icon">﷼ </span>
                        <div class="summary-content">
                            <span>(Total including tax)</span> <span>الإجمالي شامل الضريبة</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>