<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ClickPay Payment</title>
    <style>
        .row { margin-bottom: 10px; }
        label { display: block; }
        input { margin-right: 5px; padding: 5px; }
        #paymentErrors { color: red; }
    </style>
</head>
<body>
    <h1>Complete Your Payment</h1>
    <form action="/api/payment/process" id="payform" method="post">
        <span id="paymentErrors"></span>
        <input type="hidden" name="cart_id" value="<%= cartId %>">  <!-- Dynamic from backend -->
        <input type="hidden" name="cart_amount" value="<%= amount %>">  <!-- e.g., 100.00 -->
        <input type="hidden" name="cart_description" value="<%= description %>">  <!-- e.g., "Order #123" -->
        
        <div class="row">
            <label>Card Number</label>
            <input type="text" data-paylib="number" size="20" required>
        </div>
        <div class="row">
            <label>Expiry Date (MM/YYYY)</label>
            <input type="text" data-paylib="expmonth" size="2" maxlength="2" placeholder="MM" required>
            <input type="text" data-paylib="expyear" size="4" maxlength="4" placeholder="YYYY" required>
        </div>
        <div class="row">
            <label>Security Code</label>
            <input type="text" data-paylib="cvv" size="4" maxlength="4" required>
        </div>
        <input type="submit" value="Place Order">
    </form>

    <script src="https://secure.clickpay.com.sa/payment/js/paylib.js"></script>
    <script type="text/javascript">
        var myform = document.getElementById('payform');
        paylib.inlineForm({
            'key': '<%= clientKey %>',  // Dynamic from backend
            'form': myform,
            'autoSubmit': true,
            'callback': function(response) {
                document.getElementById('paymentErrors').innerHTML = '';
                if (response.error) {
                    paylib.handleError(document.getElementById('paymentErrors'), response);
                } else {
                    // Token is auto-added to form as 'payment_token'
                    console.log('Token ready:', response.token);
                }
            }
        });
    </script>
</body>
</html>